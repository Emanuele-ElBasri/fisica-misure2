<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Fabbrica di Precisione</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Special+Elite&family=Courier+Prime:wght@400;700&family=IM+Fell+English:ital@0;1&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier Prime', 'Courier New', monospace;
            background: 
                radial-gradient(circle at 15% 20%, rgba(101, 67, 33, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 85% 80%, rgba(101, 67, 33, 0.12) 0%, transparent 40%),
                radial-gradient(circle at 50% 50%, rgba(139, 90, 43, 0.05) 0%, transparent 60%),
                linear-gradient(135deg, #f4e4c1 0%, #e8d4b0 25%, #d9bc8c 50%, #e8d4b0 75%, #f4e4c1 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                repeating-linear-gradient(0deg, transparent, transparent 1px, rgba(101, 67, 33, 0.03) 1px, rgba(101, 67, 33, 0.03) 2px),
                repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(101, 67, 33, 0.02) 1px, rgba(101, 67, 33, 0.02) 2px);
            pointer-events: none;
            z-index: 0;
        }

        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(ellipse at 10% 15%, rgba(139, 90, 43, 0.08) 0%, transparent 30%),
                radial-gradient(ellipse at 90% 85%, rgba(160, 120, 70, 0.06) 0%, transparent 25%),
                radial-gradient(ellipse at 30% 70%, rgba(139, 90, 43, 0.05) 0%, transparent 20%),
                radial-gradient(ellipse at 70% 30%, rgba(160, 120, 70, 0.07) 0%, transparent 25%);
            pointer-events: none;
            z-index: 0;
        }

        .gear {
            position: fixed;
            color: rgba(139, 90, 43, 0.15);
            font-size: 120px;
            animation: rotate 20s linear infinite;
            pointer-events: none;
            z-index: 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .gear1 { top: 5%; left: 3%; animation-duration: 25s; }
        .gear2 { top: 60%; right: 5%; font-size: 150px; animation-duration: 30s; animation-direction: reverse; }
        .gear3 { bottom: 10%; left: 8%; font-size: 90px; animation-duration: 20s; animation-direction: reverse; }
        .gear4 { top: 30%; right: 15%; font-size: 70px; animation-duration: 18s; }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .container {
            max-width: 1400px;
            margin: 40px auto;
            background: linear-gradient(135deg, rgba(232, 212, 176, 0.95) 0%, rgba(217, 188, 140, 0.95) 100%);
            border: 6px solid #8b5a2b;
            box-shadow: 
                0 0 0 2px #654321,
                0 0 0 4px #8b5a2b,
                0 20px 50px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                inset 0 0 100px rgba(139, 90, 43, 0.08);
            padding: 50px 40px;
            position: relative;
            z-index: 1;
        }

        .rivet {
            position: absolute;
            width: 16px;
            height: 16px;
            background: radial-gradient(circle, #8b6914 0%, #5d4610 100%);
            border-radius: 50%;
            border: 2px solid #654321;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.6), 0 2px 4px rgba(0,0,0,0.3);
        }

        .rivet::before, .rivet::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 6px;
            height: 2px;
            background: #654321;
        }

        .rivet::before { transform: translate(-50%, -50%); }
        .rivet::after { transform: translate(-50%, -50%) rotate(90deg); }

        .rivet-tl { top: 25px; left: 25px; }
        .rivet-tr { top: 25px; right: 25px; }
        .rivet-bl { bottom: 25px; left: 25px; }
        .rivet-br { bottom: 25px; right: 25px; }

        .metal-strip {
            position: absolute;
            background: linear-gradient(90deg, #8b6914 0%, #b8860b 50%, #8b6914 100%);
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.3), inset 0 -1px 0 rgba(0, 0, 0, 0.5);
        }

        .metal-strip-top { top: 0; left: 0; right: 0; height: 6px; }
        .metal-strip-bottom { bottom: 0; left: 0; right: 0; height: 6px; }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 4px solid #8b5a2b;
            box-shadow: 0 2px 0 rgba(139, 90, 43, 0.3);
        }

        h1 {
            font-family: 'IM Fell English', serif;
            font-size: 2.8em;
            color: #4a3020;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2), 0 0 20px rgba(139, 90, 43, 0.2);
            font-style: italic;
            letter-spacing: 3px;
        }

        h1::before { content: '‚öô '; font-style: normal; color: #8b5a2b; }
        h1::after { content: ' ‚öô'; font-style: normal; color: #8b5a2b; }

        .subtitle {
            font-size: 1.1em;
            color: #6d4a2a;
            font-style: italic;
            margin-top: 10px;
        }

        h2 {
            font-family: 'IM Fell English', serif;
            color: #4a3020;
            font-size: 2em;
            margin-bottom: 20px;
            border-bottom: 3px solid #8b5a2b;
            padding-bottom: 10px;
        }

        h3 {
            font-family: 'IM Fell English', serif;
            color: #4a3020;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid #8b5a2b;
            padding-bottom: 8px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .section {
            background: linear-gradient(135deg, rgba(255, 248, 230, 0.6) 0%, rgba(245, 235, 210, 0.6) 100%);
            border: 4px solid #8b5a2b;
            border-radius: 8px;
            padding: 20px;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.1), 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .info-box {
            padding: 15px;
            background: rgba(139, 90, 43, 0.15);
            border: 2px solid #8b5a2b;
            border-radius: 6px;
            margin-bottom: 20px;
            color: #4a3020;
        }

        .info-box strong {
            color: #654321;
        }

        .info-box.success {
            background: rgba(76, 175, 80, 0.2);
            border: 2px solid #4caf50;
            color: #2e7d32;
        }

        .info-box.error {
            background: rgba(244, 67, 54, 0.2);
            border: 2px solid #f44336;
            color: #c62828;
        }

        /* Dashboard */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .dashboard-item {
            padding: 15px;
            background: linear-gradient(135deg, rgba(232, 212, 176, 0.8) 0%, rgba(217, 188, 140, 0.8) 100%);
            border: 3px solid #8b5a2b;
            border-radius: 8px;
            text-align: center;
        }

        .dashboard-item .label {
            font-weight: bold;
            color: #654321;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .dashboard-item .value {
            font-size: 28px;
            color: #4a3020;
            font-weight: bold;
        }

        .timer {
            color: #c62828 !important;
        }

        /* Componente in ispezione */
        .component-display {
            height: 300px;
            background: 
                repeating-linear-gradient(0deg, transparent 0px, transparent 49px, rgba(139, 90, 43, 0.1) 49px, rgba(139, 90, 43, 0.1) 50px),
                repeating-linear-gradient(90deg, transparent 0px, transparent 49px, rgba(139, 90, 43, 0.1) 49px, rgba(139, 90, 43, 0.1) 50px),
                linear-gradient(180deg, rgba(255, 250, 240, 0.9) 0%, rgba(250, 240, 220, 0.9) 100%);
            border: 2px solid #a0774a;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
            position: relative;
        }

        .component-icon {
            font-size: 120px;
            animation: gentle-pulse 3s ease-in-out infinite;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .component-icon svg {
            width: 120px;
            height: 120px;
        }

        @keyframes gentle-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .component-name {
            font-size: 1.5em;
            font-weight: bold;
            color: #4a3020;
            margin-top: 15px;
        }

        /* Specifiche */
        .specs-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        .spec-item {
            padding: 15px;
            background: rgba(255, 248, 230, 0.5);
            border: 2px solid #a0774a;
            border-radius: 6px;
        }

        .spec-item .label {
            font-weight: bold;
            color: #654321;
            margin-bottom: 5px;
            font-size: 12px;
        }

        .spec-item .value {
            font-size: 20px;
            color: #4a3020;
            font-weight: bold;
        }

        /* Calcoli */
        .calculation-input {
            margin: 20px 0;
        }

        .calculation-input label {
            display: block;
            margin-bottom: 10px;
            color: #4a3020;
            font-weight: bold;
        }

        .calculation-input input {
            width: 100%;
            padding: 12px;
            background: rgba(255, 248, 230, 0.8);
            border: 3px solid #8b5a2b;
            border-radius: 6px;
            color: #4a3020;
            font-family: 'Courier Prime', monospace;
            font-size: 16px;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .calculation-input input:focus {
            outline: none;
            border-color: #d4a520;
            box-shadow: 
                inset 0 2px 5px rgba(0, 0, 0, 0.1),
                0 0 10px rgba(212, 165, 32, 0.3);
        }

        /* Pulsanti decisione */
        .decision-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        button {
            font-family: 'Special Elite', monospace;
            padding: 15px 20px;
            background: linear-gradient(180deg, #8b5a2b 0%, #654321 100%);
            color: #f4e4c1;
            border: 3px solid #654321;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                0 3px 8px rgba(0, 0, 0, 0.3);
            transition: all 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                0 5px 12px rgba(0, 0, 0, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-accept {
            background: linear-gradient(180deg, #4caf50 0%, #2e7d32 100%);
            border-color: #2e7d32;
        }

        .btn-reject {
            background: linear-gradient(180deg, #f44336 0%, #c62828 100%);
            border-color: #c62828;
        }

        .btn-primary {
            background: linear-gradient(180deg, #d4a520 0%, #b8860b 100%);
            border-color: #b8860b;
            color: #4a3020;
        }

        /* Storico */
        .history-list {
            max-height: 400px;
            overflow-y: auto;
            padding: 15px;
            background: rgba(255, 248, 230, 0.5);
            border: 2px solid #a0774a;
            border-radius: 6px;
        }

        .history-item {
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 6px;
            border: 2px solid;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }

        .history-item.correct {
            background: rgba(76, 175, 80, 0.1);
            border-color: #4caf50;
        }

        .history-item.wrong {
            background: rgba(244, 67, 54, 0.1);
            border-color: #f44336;
        }

        .history-item .icon {
            font-size: 24px;
            display: flex;
            align-items: center;
            flex-shrink: 0;
        }

        .history-item .icon svg {
            width: 28px;
            height: 28px;
        }

        .history-item .details {
            flex: 1;
            margin-left: 10px;
        }

        .history-item .result {
            font-weight: bold;
        }

        /* Game over */
        .game-over {
            text-align: center;
            padding: 40px;
        }

        .game-over .final-score {
            font-size: 48px;
            color: #d4a520;
            font-weight: bold;
            margin: 20px 0;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .dashboard {
                grid-template-columns: repeat(3, 1fr);
            }

            .specs-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 20px 15px;
                margin: 20px auto;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .gear {
                font-size: 80px;
            }

            .dashboard {
                grid-template-columns: 1fr;
            }

            .decision-buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="gear gear1">‚öô</div>
    <div class="gear gear2">‚öô</div>
    <div class="gear gear3">‚öô</div>
    <div class="gear gear4">‚öô</div>
    
    <div class="container">
        <div class="rivet rivet-tl"></div>
        <div class="rivet rivet-tr"></div>
        <div class="rivet rivet-bl"></div>
        <div class="rivet rivet-br"></div>
        
        <div class="metal-strip metal-strip-top"></div>
        <div class="metal-strip metal-strip-bottom"></div>
        
        <header>
            <h1>La Fabbrica di Precisione</h1>
            <div class="subtitle">I.C. "C.Puddu", Corso di Fisica - prof. El Basri</div>
            <div class="subtitle">Controllo Qualit√† dei Componenti Meccanici</div>
        </header>

        <!-- Schermata iniziale -->
        <div id="start-screen">
            <div class="info-box" style="text-align: center; padding: 40px;">
                <h2 style="border: none; margin-bottom: 20px;">üè≠ Benvenuto Ispettore di Qualit√†!</h2>
                <p style="font-size: 1.1em; margin-bottom: 20px;">
                    La tua missione √® ispezionare <strong>10 componenti meccanici</strong> in arrivo dalla linea di produzione.<br>
                    Devi decidere se <strong>ACCETTARE</strong> o <strong>RIFIUTARE</strong> ogni componente basandoti sulla tolleranza consentita.
                </p>
                <p style="margin-bottom: 20px;">
                    <strong>Come funziona:</strong><br>
                    ‚Ä¢ Hai <strong>60 secondi per ogni componente</strong><br>
                    ‚Ä¢ Calcola l'errore percentuale: eR% = [Valore Misurato - Valore Nominale (Va)] / Valore Nominale (Va) √ó 100<br>
                    ‚Ä¢ <strong>Inserisci il valore calcolato</strong> nel campo apposito<br>
                    ‚Ä¢ Accetta se eR% ‚â§ tolleranza, altrimenti rifiuta<br>
                    ‚Ä¢ Se non inserisci nulla entro 60 secondi, conta come errore!
                </p>
                <button class="btn-primary" id="start-btn" style="font-size: 18px; padding: 20px 40px;">
                    üé¨ Inizia Turno di Lavoro
                </button>
            </div>
        </div>

        <!-- Schermata di gioco -->
        <div id="game-screen" style="display: none;">
            <!-- Dashboard -->
            <div class="dashboard">
                <div class="dashboard-item">
                    <div class="label">üì¶ Componente</div>
                    <div class="value"><span id="current-piece">1</span>/10</div>
                </div>
                <div class="dashboard-item">
                    <div class="label">‚è±Ô∏è Tempo Pezzo</div>
                    <div class="value timer" id="timer">60</div>
                </div>
                <div class="dashboard-item">
                    <div class="label">‚úì Corrette</div>
                    <div class="value" id="correct-count">0</div>
                </div>
            </div>

            <div class="main-content">
                <!-- Pannello sinistro: Ispezione -->
                <div class="section">
                    <h2>üîç Componente in Ispezione</h2>
                    
                    <div class="component-display">
                        <div class="component-icon" id="component-icon"></div>
                        <div class="component-name" id="component-name">Ingranaggio</div>
                    </div>

                    <h3>üìã Specifiche Tecniche:</h3>
                    <div class="specs-grid">
                        <div class="spec-item">
                            <div class="label">Valore Nominale (Va)</div>
                            <div class="value" id="nominal-value">10.00 cm</div>
                        </div>
                        <div class="spec-item">
                            <div class="label">Valore Misurato (Vm)</div>
                            <div class="value" id="measured-value">10.15 cm</div>
                        </div>
                        <div class="spec-item" style="grid-column: 1 / -1;">
                            <div class="label">Tolleranza Massima Consentita</div>
                            <div class="value" id="tolerance-value">¬±2.0%</div>
                        </div>
                    </div>

                    <div class="calculation-input">
                        <label for="error-input">Calcola l'Errore Percentuale (eR%):</label>
                        <input type="number" id="error-input" step="0.01" placeholder="Inserisci il tuo calcolo...">
                        <div style="font-size: 1.2em; color: #6d4a2a; margin-top: 8px; font-weight: bold; text-align: center;">
                            Formula: eR% = (Vm - Va) / Va √ó 100
                        </div>
                    </div>

                    <div class="decision-buttons">
                        <button class="btn-accept" id="accept-btn">
                            ‚úì ACCETTA<br>
                            <small>Componente OK</small>
                        </button>
                        <button class="btn-reject" id="reject-btn">
                            ‚úó RIFIUTA<br>
                            <small>Fuori Tolleranza</small>
                        </button>
                    </div>

                    <div id="feedback-area"></div>
                </div>

                <!-- Pannello destro: Storico -->
                <div class="section">
                    <h2>üìä Storico Ispezioni</h2>
                    <div class="history-list" id="history-list">
                        <div class="info-box" style="text-align: center;">
                            Nessuna ispezione ancora effettuata
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Schermata finale -->
        <div id="end-screen" style="display: none;">
            <div class="game-over">
                <h2 style="font-size: 3em; border: none; margin-bottom: 20px;">‚úÖ Turno Completato!</h2>
                
                <div class="info-box" style="max-width: 600px; margin: 0 auto 30px;">
                    <div class="label" style="font-size: 1.2em; margin-bottom: 15px;">Punteggio Finale</div>
                    <div class="final-score" id="final-score">0</div>
                    <div style="font-size: 1.1em; margin-top: 15px;">
                        <strong id="final-correct">0</strong> corrette su 10 componenti
                    </div>
                    <div style="font-size: 1em; margin-top: 10px; color: #6d4a2a;">
                        ‚è±Ô∏è Tempo totale impiegato: <strong id="total-time">0</strong> secondi
                    </div>
                </div>

                <div id="performance-message"></div>

                <button class="btn-primary" id="restart-btn" style="font-size: 18px; padding: 20px 40px; margin-top: 30px;">
                    üîÑ Nuovo Turno di Lavoro
                </button>
            </div>
        </div>

        <!-- Pulsante Nuovo Esercizio -->
        <div id="new-exercise-section" style="margin-top: 40px; padding-top: 30px; border-top: 4px solid #8b5a2b; display: none;">
            <h3 style="font-family: 'IM Fell English', serif; color: #4a3020; text-align: center; margin-bottom: 20px;">
                üé≤ Nuovo Esercizio
            </h3>
            <div class="info-box" style="text-align: center;">
                Genera nuove tolleranze e componenti casuali per un nuovo esercizio!
            </div>
            <button class="btn-primary" id="new-exercise-btn" style="max-width: 500px; margin: 0 auto; display: block;">
                üîÑ Genera Nuovo Esercizio
            </button>
        </div>
    </div>

    <script>
        // Configurazione componenti
        const SVG = {
            'gear-small': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="m438.582 296.069 53.302-14.694-.024-50.728-53.278-14.743c-4.76-21.901-13.445-42.325-25.185-60.608l27.323-48.157-35.904-35.855-48.078 27.3C338.4 86.818 317.975 78.16 296.053 73.347l-14.746-53.224H230.64l-14.77 53.224c-21.874 4.813-42.324 13.472-60.61 25.235l-48.13-27.298-35.88 35.883 27.3 48.077c-11.74 18.336-20.401 38.76-25.236 60.66l-53.198 14.744v50.727l53.198 14.694a186.28 186.28 0 0 0 25.235 60.658l-27.298 48.157 35.88 35.83 48.128-27.274a186.217 186.217 0 0 0 60.66 25.186l14.72 53.25 50.693-.024 14.72-53.225c21.923-4.813 42.348-13.47 60.686-25.212l48.127 27.327 35.805-35.883-27.273-48.155c11.714-18.31 20.4-38.708 25.185-60.635zM200.588 122.394h110.819l78.333 78.358v9.207h-55.162c-15.844-26.933-45.134-45.051-78.582-45.051-33.445 0-62.735 18.118-78.578 45.051H122.23v-9.207zm55.408 88.542c24.88 0 45.072 20.196 45.072 45.052 0 24.929-20.19 45.1-45.072 45.1-24.872 0-45.068-20.17-45.068-45.1 0-24.856 20.196-45.052 45.068-45.052zm55.411 179.05H200.588l-78.357-78.358v-9.612h55.106a91.66 91.66 0 0 0 14.253 18.417c17.206 17.206 40.082 26.681 64.407 26.681 24.333 0 47.208-9.476 64.415-26.683a91.636 91.636 0 0 0 14.25-18.415h55.079v9.612z" fill="#8b5a2b"/></svg>',
            'gear-medium': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="m235.045 25.752-41.775 8.215 6.894 35.947c-19.303 5.91-37.997 14.43-54.643 25.852l-23.834-27.78L89.04 96.158l24.433 27.988c-13.495 14.454-25.328 31.203-34.16 49.78L44.64 161.813l-14.203 40.652 34.674 12.11c-4.54 19.832-5.6 40.113-4.057 59.624l-36.547 6.685 8.006 42.37 35.947-6.896c5.91 19.303 15.235 37.61 26.657 54.255L67.34 394.45l27.572 32.44 27.78-23.837c14.537 13.64 31.05 25.255 49.78 34.158l-12.115 34.675 40.653 14.2 12.11-34.67c20.202 4.695 40.354 5.885 60.222 4.267l6.894 35.947 41.774-8.214-6.895-35.947c19.304-5.912 38-14.43 54.645-25.853l23.836 27.778 32.646-28.17-24.433-27.99c13.355-14.305 25.153-30.836 33.948-49.18l34.674 12.113 14.2-40.652-34.673-12.112c4.654-20.034 5.825-40.508 4.27-60.22l36.543-6.688-8.003-42.37-35.948 6.894c-5.91-19.304-15.237-37.608-26.66-54.254l27.78-23.836-27.573-32.438-27.78 23.836c-14.538-13.64-31.05-25.257-49.78-34.16l11.905-34.076-40.65-14.2v.003L302.16 65.97c-20.2-4.698-40.35-5.887-60.22-4.27l-6.895-35.948zm23.178 87.603c28.01.105 56.29 8.287 81.183 25.24 59.008 40.186 79.122 116.127 51.112 179.13l-57.065-38.862c8.25-31.382-3.378-65.89-31.715-85.19-28.34-19.3-64.227-17.152-90.408 2.02l-57.316-39.033c27.96-28.41 65.826-43.448 104.21-43.305zM124.7 199.582l56.89 38.744c-8.423 31.474 2.948 66.307 31.39 85.676 28.44 19.37 65.5 17.52 91.7-1.848l56.625 38.565c-48.347 49.327-126.52 58.51-185.614 18.266C116.6 338.742 96.51 262.64 124.7 199.582zm132.87 14.29a44.75 44.75 0 0 1 25.102 7.798c20.516 13.973 25.83 41.964 11.857 62.48-13.972 20.517-41.967 25.827-62.483 11.856-20.516-13.972-25.827-41.964-11.856-62.48 8.734-12.823 22.942-19.707 37.38-19.655z" fill="#8b5a2b"/></svg>',
            'gear-large': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 511 511"><path d="m265.344 17.5-4.188 25.313c-17.714-.104-35.371 2.006-52.562 6.28l-9.438-25.062-55.125 20.75 9.907 26.282c-15.022 8.589-28.956 18.956-41.5 30.876L90 83.53 52.625 129.03 75.75 148c-8.672 14.656-15.554 30.299-20.5 46.594l-30.063-4.97-9.593 58.095 30.406 5.031c-.374 17.218 1.313 34.127 4.906 50.438L22 314.063 42.75 369.188l28.625-10.782c8.074 15.026 17.902 29.041 29.28 41.75l-18.967 23.094 45.532 37.344 18.343-22.344c14.386 9.118 30.04 16.577 46.687 22.125l-4.53 27.5 58.093 9.594 4.343-26.283c18.046.874 35.764-.54 52.875-4.03l8.97 23.78 55.094-20.75-8.53-22.656c16.122-8.338 31.126-18.68 44.655-30.78l17.936 14.72 37.344-45.533-17.188-14.093c9.887-15.598 17.703-32.416 23.25-50.03l21.407 3.53 9.56-58.094-21.06-3.47c.602-18.511-1.216-37.02-5.408-55.06l19.844-7.47-20.75-55.125-20.187 7.594c-8.894-16.119-19.816-31.032-32.5-44.376l14.155-17.25-45.5-37.375-14.72 17.936c-15.396-9.116-32.13-16.37-49.936-21.47l3.967-24.092zM256 84.5c-80.154 3.037-149.672 61.917-163.25 144.186-15.52 94.022 47.977 182.606 142 198.125 94.02 15.52 182.573-47.977 198.093-142 15.52-94.02-47.947-182.573-141.97-198.092A163.46 163.46 0 0 0 256 84.5z" fill="#8b5a2b"/></svg>',
            'wheel': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M256 16v72H88l48 48L16 256h72v168l48-48 120 120v-72h168l-48-48 120-120h-72V88l-48 48L256 16zm0 120c66.274 0 120 53.726 120 120s-53.726 120-120 120-120-53.726-120-120 53.726-120 120-120zm0 72a48 48 0 0 0-48 48 48 48 0 0 0 48 48 48 48 0 0 0 48-48 48 48 0 0 0-48-48z" fill="#8b5a2b"/></svg>',
            'pipe': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M440.783 22.424c-2.382.04-4.63.42-6.646 1.178l-148.725 93.875-125.28 165.15a557.495 557.495 0 0 1 1.65 13.713L145.435 302 52.56 424.432a38.188 26.876 37.184 0 1 30.288 9.912 38.188 26.876 37.184 0 1 18.03 28.566l219.278-289.056-1.943-31.5 12.213 23.632 140.47-88.664c7.383-9.426 8.96-18.574 7.038-26.62l-15.998 5.54L472.48 39.27c-2.533-3.414-5.665-6.433-9.13-8.93-7.054-5.082-15.42-8.035-22.567-7.916zM52.705 438.676a30.876 21.73 37.184 0 0-1.857.023 30.876 21.73 37.184 0 0-14.244 6.763 30.876 21.73 37.184 0 0 11.464 35.974 30.876 21.73 37.184 0 0 37.735 1.348 30.876 21.73 37.184 0 0-11.47-35.973 30.876 21.73 37.184 0 0-21.628-8.136z" fill="#8b5a2b"/></svg>',
            'valve': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M234.875 18.78c-26.087 2.367-51.557 8.56-74.875 18.782 15.37 32.763 14.222 66.706-6.72 82.407-20.835 15.617-54.055 7.965-81.124-15.69-16.246 19.452-29.336 41.36-38.875 65.626 33.83 12.333 56.635 37.665 52.94 63.5-3.698 25.835-32.697 43.74-68.626 46.094 2.338 25.796 8.91 50.778 18.937 73.875 17.81-8.182 35.793-11.09 51.095-8.938 13.032 1.87 23.927 7.015 31.156 16.657 15.817 21.097 7.603 54.713-16.78 81.97 19.516 16.35 42.216 29.444 66.594 39.03 12.33-33.828 37.655-56.634 63.5-52.938 25.844 3.697 43.74 32.696 46.094 68.625 26.087-2.365 51.557-8.555 74.875-18.78-15.766-32.997-14.26-67.588 6.843-83.406 9.64-7.23 22.568-9.022 35.594-7.125 15.112 2.16 31.19 10.25 45.563 22.78 16.088-19.345 29.4-41.51 38.875-65.594-33.83-12.332-56.635-37.653-52.938-63.5 3.697-25.846 32.665-43.772 68.594-46.125-2.36-25.944-8.774-50.663-18.906-73.874-32.612 15.117-66.66 13.145-82.282-7.687-15.696-20.944-7.252-53.86 16.688-81-19.52-16.352-42.248-29.447-66.625-39.032-12.332 33.828-37.657 56.66-63.5 52.968-25.846-3.693-43.744-32.696-46.095-68.625zm21.656 95.126c79.626 0 144.376 64.752 144.376 144.375 0 79.626-64.75 144.376-144.375 144.376-79.624 0-144.374-64.75-144.374-144.375 0-79.624 64.75-144.374 144.375-144.374zm0 34c61.094 0 110.376 49.282 110.376 110.375 0 61.095-49.282 110.376-110.376 110.376-61.094 0-110.375-49.28-110.375-110.376 0-61.093 49.281-110.374 110.375-110.374z" fill="#b8860b"/></svg>',
            'bolt': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M256 31.365 29.44 123.697v179.9L256 395.926l226.56-92.33v-179.9L256 31.365zm0 73.93c38.765 0 74.22 10.93 100.89 29.756 26.72 18.864 45.11 46.74 45.11 78.596s-18.39 59.733-45.11 78.596C330.22 311.067 294.764 322 256 322s-74.22-10.933-100.89-29.758C128.39 273.38 110 245.502 110 213.646c0-31.855 18.39-59.732 45.11-78.595 26.67-18.824 62.125-29.755 100.89-29.755zm0 56c-33.522 0-63.704 10.264-85.11 26.318-21.357 15.076-35.23 35.528-37.23 58.207 7.18-14.2 18.19-26.816 31.83-37.047C185.01 190.228 218.83 179 256 179c37.17 0 70.99 11.227 95.91 29.918 13.64 10.23 24.65 22.846 31.83 37.047-2-22.68-15.873-43.13-37.23-58.207C323.328 171.394 289.52 161 256 161zM29.44 323.033v70.916L247 482.612v-70.916L29.44 323.033zm453.12 0L265 411.7v70.913l217.56-88.664v-70.917z" fill="#8b5a2b"/></svg>',
            'spring': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M326.4 26.52c-.7 0-1.7.14-2.9.44-3.4.82-8 3.38-11.7 6.89-3.8 3.51-6.7 7.92-7.9 11.34-1.1 3.41-.8 4.92.5 6.57 27.4 33.77 52.6 72.04 71.9 105.74 19.3 33.8 32.7 62.2 36.6 79.9.4 1.8.7 2 .7 1.9 1.2 0 5.7-1.7 9.9-5.2 4.3-3.5 8.6-8.6 11.1-13.3 2.6-4.7 3.1-8.8 2.6-10.4-15.1-55.3-42.6-116.41-107.9-182.57-.7-.67-1.3-1.09-2.2-1.24zm53.2 30.97c11 13.92 20.6 27.66 28.9 41.17 13 7.24 28.5 16.34 43.9 26.04 15.2 9.4 29.4 18.9 40.9 27.4l-1.8-28.2c-16.4-16.3-45-33.55-74.1-48.31-13.1-6.65-25.8-12.61-37.8-18.1zM247.1 105.8c-.7 0-1.7.1-2.9.4-3.4.8-7.9 3.4-11.7 6.9-3.7 3.5-6.6 7.9-7.7 11.3-1.1 3.3-.9 4.8.5 6.5 27.4 33.8 52.6 72 71.9 105.7 19.3 33.8 32.6 62.3 36.6 79.8v.1c.4 1.8.7 2 .7 1.9 1.1 0 5.6-1.7 9.9-5.2 4.3-3.5 8.5-8.6 11.1-13.3 2.5-4.7 3-8.9 2.6-10.4-15.3-55.2-42.8-116.2-108.1-182.4-.7-.7-1.3-1.1-2.2-1.2zm53.1 30.9c11.1 14 20.7 27.8 29.1 41.3 13 7.3 28.5 16.4 43.9 26 3.5 2.2 7 4.4 10.4 6.6-5.8-12.7-13.6-27.7-22.7-43.7-7.4-4.2-15-8.2-22.7-12.1-13.2-6.6-25.9-12.6-38-18.1zm-126.5 57.1c-.7 0-1.7.1-2.9.4-3.4.8-8 3.4-11.7 6.9-3.8 3.5-6.7 7.9-7.9 11.3-1.1 3.4-.8 4.9.5 6.5 27.4 33.7 52.6 71.9 71.9 105.7 19.3 33.8 32.7 62.2 36.6 79.9.4 1.8.7 2 .7 1.9 1.1 0 5.7-1.7 9.9-5.2 4.3-3.5 8.6-8.6 11.1-13.3 2.6-4.8 3.1-8.9 2.6-10.5-15.2-55.1-42.6-116.1-107.9-182.4-.7-.6-1.3-1-2.2-1.2zm53.1 30.9c11.1 13.9 20.6 27.7 29 41.2 13 7.3 28.5 16.4 43.9 26 2.7 1.7 5.4 3.4 8 5-5.2-11.9-12.5-26.6-21.3-42.5-7.1-4-14.4-7.9-21.8-11.6-13.1-6.7-25.8-12.6-37.8-18.1zM94.5 272.9c-.77 0-1.71.2-2.97.5-3.34.8-7.91 3.3-11.67 6.8s-6.68 7.9-7.79 11.3c-1.1 3.4-.86 4.9.48 6.5 27.43 33.8 52.65 72 71.95 105.7 19.3 33.8 32.7 62.2 36.6 79.8v.1c.4 1.8.7 2 .7 1.9 1.2 0 5.7-1.7 9.9-5.2 4.3-3.5 8.6-8.6 11.1-13.3 2.6-4.7 3.1-8.8 2.6-10.4-15.3-55.1-42.7-116.1-108.02-182.4-.7-.6-1.3-1.1-2.17-1.2zm53.1 30.9c11.1 14 20.7 27.8 29 41.3 13 7.3 28.5 16.4 43.9 26 3.5 2.2 7 4.4 10.4 6.6-5.8-12.7-13.5-27.7-22.6-43.7-7.4-4.1-15.1-8.2-22.8-12.1-13.1-6.6-25.8-12.6-37.9-18.1zM18.72 353c.34 2.1 1.03 4.8 2.88 8.4 5.75 11.3 20.09 27.8 46.74 42.6 23.89 13.3 46.86 28.4 85.06 56.4-6-13.5-14.4-30.1-24.5-47.7l-.3-.6C92.89 388 46.1 366 18.72 353z" fill="#8b5a2b"/></svg>',
            'cylinder': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M225 25v30h62V25zm8 48v28.6l-5 2.5C211 112.6 187.4 120.4 168.6 131.7c-9.6 5.8-17.6 12-23.2 19.3h221.2c-5.6-7.3-13.6-13.5-23.2-19.3-18.8-11.3-42.4-19.1-59.4-27.6L279 101.6V73zm-102 96h250v16H131zm16 34h218v28H147zm-26 46h270v30H121zm16 48h238v94H137zm0 112v39c0 1 1.1 4.9 4 9.3 2.9 4.3 7.4 9.3 12.8 13.8C164.6 480.1 179 487 192 487h128c13 0 27.4-6.9 38.2-15.9 5.4-4.5 9.9-9.5 12.8-13.8 2.9-4.4 4-8.3 4-9.3v-39z" fill="#8b5a2b"/></svg>'
        };

        const components = [
            { icon: SVG['gear-small'],  name: 'Ingranaggio Piccolo',  nominalRange: [3, 5] },
            { icon: SVG['gear-medium'], name: 'Ingranaggio Medio',    nominalRange: [10, 15] },
            { icon: SVG['gear-large'],  name: 'Ingranaggio Grande',   nominalRange: [25, 35] },
            { icon: SVG['wheel'],       name: 'Ruota Dentata',        nominalRange: [55, 75] },
            { icon: SVG['pipe'],        name: 'Tubo di Metallo',      nominalRange: [20, 30] },
            { icon: SVG['valve'],       name: 'Valvola',              nominalRange: [7, 12] },
            { icon: SVG['bolt'],        name: 'Bullone',              nominalRange: [4, 6] },
            { icon: SVG['spring'],      name: 'Molla',                nominalRange: [12, 20] },
            { icon: SVG['cylinder'],    name: 'Barattolo di Vetro',   nominalRange: [35, 50] }
        ];

        const TOTAL_COMPONENTS = 10;
        const TIME_PER_COMPONENT = 60;

        let gameState = {
            isPlaying: false,
            currentPieceNumber: 1,
            timeLeft: TIME_PER_COMPONENT,
            correctCount: 0,
            wrongCount: 0,
            currentComponent: null,
            history: [],
            timerInterval: null,
            toleranceRange: [1, 5],
            totalTimeUsed: 0,
            startTime: null
        };

        // Elementi DOM
        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const endScreen = document.getElementById('end-screen');
        const startBtn = document.getElementById('start-btn');
        const restartBtn = document.getElementById('restart-btn');
        const acceptBtn = document.getElementById('accept-btn');
        const rejectBtn = document.getElementById('reject-btn');
        const errorInput = document.getElementById('error-input');
        const newExerciseBtn = document.getElementById('new-exercise-btn');
        const newExerciseSection = document.getElementById('new-exercise-section');

        // Inizia gioco
        startBtn.addEventListener('click', startGame);
        restartBtn.addEventListener('click', startGame);

        function startGame() {
            gameState = {
                isPlaying: true,
                currentPieceNumber: 1,
                timeLeft: TIME_PER_COMPONENT,
                correctCount: 0,
                wrongCount: 0,
                currentComponent: null,
                history: [],
                timerInterval: null,
                toleranceRange: gameState.toleranceRange,
                totalTimeUsed: 0,
                startTime: Date.now()
            };

            startScreen.style.display = 'none';
            gameScreen.style.display = 'block';
            endScreen.style.display = 'none';
            newExerciseSection.style.display = 'none';

            // Disabilita pulsanti all'inizio
            acceptBtn.disabled = true;
            rejectBtn.disabled = true;

            updateDashboard();
            generateNewComponent();
            startTimer();
        }

        // Timer
        function startTimer() {
            gameState.timerInterval = setInterval(() => {
                gameState.timeLeft--;
                document.getElementById('timer').textContent = gameState.timeLeft;

                if (gameState.timeLeft <= 0) {
                    // Timeout - conta come errore
                    handleTimeout();
                }
            }, 1000);
        }

        function stopTimer() {
            clearInterval(gameState.timerInterval);
        }

        function resetTimer() {
            gameState.timeLeft = TIME_PER_COMPONENT;
            document.getElementById('timer').textContent = gameState.timeLeft;
        }

        // Timeout
        function handleTimeout() {
            stopTimer();
            
            const comp = gameState.currentComponent;
            const actualError = Math.abs((comp.measured - comp.nominal) / comp.nominal * 100);
            
            gameState.wrongCount++;

            const feedbackArea = document.getElementById('feedback-area');
            feedbackArea.innerHTML = `<div class="info-box error" style="margin-top: 20px;">
                <strong>‚è∞ Tempo Scaduto!</strong><br>
                Non hai inserito un valore entro 60 secondi.<br>
                Errore percentuale corretto: ${actualError.toFixed(2)}%<br>
                Decisione corretta: ${comp.correctAnswer ? 'ACCETTARE' : 'RIFIUTARE'}
            </div>`;

            // Aggiungi allo storico
            gameState.history.unshift({
                component: comp,
                decision: null,
                correct: false,
                error: actualError,
                timeout: true
            });

            updateDashboard();
            updateHistory();

            // Prossimo componente
            setTimeout(() => {
                nextComponent();
            }, 2000);
        }

        // Abilita/disabilita pulsanti in base all'input
        errorInput.addEventListener('input', () => {
            const hasValue = errorInput.value.trim() !== '';
            acceptBtn.disabled = !hasValue;
            rejectBtn.disabled = !hasValue;
        });

        // Genera nuovo componente
        function generateNewComponent() {
            const component = components[Math.floor(Math.random() * components.length)];
            const [minNom, maxNom] = component.nominalRange;
            const nominal = Math.round((Math.random() * (maxNom - minNom) + minNom) * 10) / 10;
            
            const [minTol, maxTol] = gameState.toleranceRange;
            const tolerance = Math.round((Math.random() * (maxTol - minTol) + minTol) * 10) / 10;
            
            // Genera valore misurato
            const shouldBeAcceptable = Math.random() > 0.5;
            let measured;
            
            if (shouldBeAcceptable) {
                // Genera dentro tolleranza
                const maxError = (nominal * tolerance / 100) * 0.9;
                const error = (Math.random() - 0.5) * 2 * maxError;
                measured = nominal + error;
            } else {
                // Genera fuori tolleranza
                const minError = (nominal * tolerance / 100) * 1.2;
                const error = (Math.random() * 0.5 + minError) * (Math.random() > 0.5 ? 1 : -1);
                measured = nominal + error;
            }
            
            measured = Math.round(measured * 100) / 100;

            gameState.currentComponent = {
                icon: component.icon,
                name: component.name,
                nominal: nominal,
                measured: measured,
                tolerance: tolerance,
                correctAnswer: Math.abs((measured - nominal) / nominal * 100) <= tolerance
            };

            displayComponent();
            errorInput.value = '';
            acceptBtn.disabled = true;
            rejectBtn.disabled = true;
            document.getElementById('feedback-area').innerHTML = '';
        }

        // Visualizza componente
        function displayComponent() {
            const comp = gameState.currentComponent;
            document.getElementById('component-icon').innerHTML = comp.icon;
            document.getElementById('component-name').textContent = comp.name;
            document.getElementById('nominal-value').textContent = `${comp.nominal.toFixed(2)} cm`;
            document.getElementById('measured-value').textContent = `${comp.measured.toFixed(2)} cm`;
            document.getElementById('tolerance-value').textContent = `¬±${comp.tolerance.toFixed(1)}%`;
        }

        // Decisione
        acceptBtn.addEventListener('click', () => makeDecision(true));
        rejectBtn.addEventListener('click', () => makeDecision(false));

        function makeDecision(acceptDecision) {
            stopTimer();

            const comp = gameState.currentComponent;
            const actualError = Math.abs((comp.measured - comp.nominal) / comp.nominal * 100);
            const userError = parseFloat(errorInput.value);
            
            const isCorrect = acceptDecision === comp.correctAnswer;
            const errorCalculationCorrect = !isNaN(userError) && Math.abs(userError - actualError) < 0.1;

            if (isCorrect) {
                gameState.correctCount++;
            } else {
                gameState.wrongCount++;
            }

            // Feedback
            const feedbackArea = document.getElementById('feedback-area');
            let feedbackHTML = '';
            
            if (isCorrect) {
                feedbackHTML = `<div class="info-box success" style="margin-top: 20px;">
                    <strong>‚úì Decisione Corretta!</strong><br>
                    Errore percentuale: ${actualError.toFixed(2)}% ${comp.correctAnswer ? '‚â§' : '>'} ${comp.tolerance.toFixed(1)}%<br>
                    ${errorCalculationCorrect ? '‚úì Calcolo corretto! üéØ' : `‚ö†Ô∏è Calcolo errato: hai inserito ${userError.toFixed(2)}% (corretto: ${actualError.toFixed(2)}%)`}
                </div>`;
            } else {
                feedbackHTML = `<div class="info-box error" style="margin-top: 20px;">
                    <strong>‚úó Decisione Errata!</strong><br>
                    Errore percentuale: ${actualError.toFixed(2)}% ${comp.correctAnswer ? '‚â§' : '>'} ${comp.tolerance.toFixed(1)}%<br>
                    Dovevi ${comp.correctAnswer ? 'ACCETTARE' : 'RIFIUTARE'} il componente!<br>
                    ${errorCalculationCorrect ? 'Almeno il calcolo era corretto.' : `Calcolo errato: hai inserito ${userError.toFixed(2)}% (corretto: ${actualError.toFixed(2)}%)`}
                </div>`;
            }
            
            feedbackArea.innerHTML = feedbackHTML;

            // Aggiungi allo storico
            gameState.history.unshift({
                component: comp,
                decision: acceptDecision,
                correct: isCorrect,
                error: actualError,
                userError: userError,
                errorCalculationCorrect: errorCalculationCorrect,
                timeout: false
            });

            updateDashboard();
            updateHistory();

            // Prossimo componente
            setTimeout(() => {
                nextComponent();
            }, 2000);
        }

        // Prossimo componente
        function nextComponent() {
            if (gameState.currentPieceNumber >= TOTAL_COMPONENTS) {
                // Fine gioco
                endGame();
            } else {
                gameState.currentPieceNumber++;
                resetTimer();
                generateNewComponent();
                updateDashboard();
                startTimer();
            }
        }

        // Aggiorna dashboard
        function updateDashboard() {
            document.getElementById('current-piece').textContent = gameState.currentPieceNumber;
            document.getElementById('correct-count').textContent = gameState.correctCount;
        }

        // Aggiorna storico
        function updateHistory() {
            const historyList = document.getElementById('history-list');
            
            if (gameState.history.length === 0) {
                historyList.innerHTML = '<div class="info-box" style="text-align: center;">Nessuna ispezione ancora effettuata</div>';
                return;
            }

            historyList.innerHTML = gameState.history.map((item, index) => `
                <div class="history-item ${item.correct ? 'correct' : 'wrong'}">
                    <div class="icon">${item.component.icon}</div>
                    <div class="details">
                        <div><strong>#${TOTAL_COMPONENTS - index} - ${item.component.name}</strong></div>
                        <div style="font-size: 12px;">
                            ${item.timeout ? '‚è∞ Timeout' : `eR%: ${item.error.toFixed(2)}% | Tolleranza: ¬±${item.component.tolerance.toFixed(1)}%`}
                        </div>
                    </div>
                    <div class="result">${item.timeout ? '‚è∞' : item.correct ? '‚úì' : '‚úó'}</div>
                </div>
            `).join('');
        }

        // Fine gioco
        function endGame() {
            stopTimer();
            gameState.isPlaying = false;

            const totalTimeElapsed = Math.floor((Date.now() - gameState.startTime) / 1000);
            gameState.totalTimeUsed = totalTimeElapsed;

            const percentage = Math.round((gameState.correctCount / TOTAL_COMPONENTS) * 100);

            gameScreen.style.display = 'none';
            endScreen.style.display = 'block';
            newExerciseSection.style.display = 'block';

            document.getElementById('final-score').textContent = `${percentage}%`;
            document.getElementById('final-correct').textContent = gameState.correctCount;
            document.getElementById('total-time').textContent = totalTimeElapsed;

            let message = '';
            if (percentage === 100) {
                message = '<div class="info-box success"><strong>üèÜ PERFETTO!</strong><br>Hai ispezionato tutti i componenti correttamente! Sei un maestro del controllo qualit√†!</div>';
            } else if (percentage >= 80) {
                message = '<div class="info-box success"><strong>üëç Ottimo lavoro!</strong><br>Prestazione eccellente! La fabbrica √® in ottime mani.</div>';
            } else if (percentage >= 60) {
                message = '<div class="info-box"><strong>üìä Buon lavoro</strong><br>Discreto, ma puoi migliorare con pi√π pratica sui calcoli degli errori.</div>';
            } else {
                message = '<div class="info-box error"><strong>üìö Da rivedere</strong><br>Ripassa il calcolo dell\'errore percentuale e le tolleranze, poi riprova!</div>';
            }

            document.getElementById('performance-message').innerHTML = message;
        }

        // Nuovo esercizio
        newExerciseBtn.addEventListener('click', () => {
            // Genera nuova tolleranza casuale
            const minTol = Math.round((Math.random() * 1.5 + 0.5) * 10) / 10;
            const maxTol = Math.round((Math.random() * 3 + 2.5) * 10) / 10;
            
            gameState.toleranceRange = [minTol, maxTol];

            // Mostra messaggio
            const message = `
                <div class="info-box success" style="text-align: center; padding: 30px;">
                    <strong>‚úì Nuovo esercizio generato!</strong><br><br>
                    Nuova gamma di tolleranze: <strong>¬±${minTol.toFixed(1)}% - ¬±${maxTol.toFixed(1)}%</strong><br><br>
                    Clicca "Nuovo Turno di Lavoro" per iniziare!
                </div>
            `;

            endScreen.innerHTML = `
                <div class="game-over">
                    ${message}
                    <button class="btn-primary" id="restart-btn-new" style="font-size: 18px; padding: 20px 40px; margin-top: 30px;">
                        üîÑ Nuovo Turno di Lavoro
                    </button>
                </div>
            `;

            document.getElementById('restart-btn-new').addEventListener('click', startGame);
        });
    </script>
</body>
</html>
